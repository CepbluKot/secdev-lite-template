# S03 - Реестр NFR для сервиса уведомлений о приезде такси

| ID      | User Story / Feature                  | Category                  | Requirement (NFR)                                                                 | Rationale / Risk                        | Acceptance (G-W-T)                                                                                                         | Evidence (test/log/scan/policy)         | Trace (issue/link) | Owner   | Status   | Priority    | Severity   | Tags                  |
| ------- | ------------------------------------- | ------------------------- | ------------------------------------------------------------------------------- | --------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- | --------------------------------------- | ------------------ | ------- | -------- | ----------- | ---------- | --------------------- |
| NFR-101 | Уведомление о приезде такси           | RateLimiting              | Не более 3 уведомлений на пользователя в течение 10 минут                        | Защита от спама и DoS                   | **Given** пользователь получает уведомления<br>**When** отправляется 4-е уведомление за 10 минут<br>**Then** ответ 429     | test: e2e-rate-limit                    | #taxi-notify      | team-taxi | Draft    | P1 - High   | S2 - Major | rate,notify           |
| NFR-102 | Уведомление о приезде такси           | Timeouts/Retry            | Внешние вызовы на SMS/email/push: timeout ≤ 2s, retry ≤ 2                        | Устойчивость к зависимостям             | **Given** недоступность внешнего сервиса<br>**When** отправляется уведомление<br>**Then** не более 2 попыток, ожидание ≤2s | test: integration-fail                  | #taxi-notify      | team-taxi | Draft    | P2 - Medium | S2 - Major | timeout,retry         |
| NFR-103 | Уведомление о приезде такси           | Privacy/PII               | PII не попадает в логи, хранится ≤ 7 дней                                        | Соответствие privacy и комплаенсу       | **Given** логирование события<br>**When** в логе есть персональные данные<br>**Then** они маскированы или удалены          | log: masked-example                     | #taxi-notify      | team-taxi | Draft    | P1 - High   | S1 - Critical | privacy,pii         |
| NFR-104 | Уведомление о приезде такси           | Performance               | P95 задержки отправки уведомления ≤ 500 мс при 30 RPS в течение 5 минут          | UX/SLO, своевременность оповещения      | **Given** сервис здоров<br>**When** 30 RPS на /api/notifications/ride-arrival 5 минут<br>**Then** P95 ≤ 500 мс, error ≤ 1% | test: load-30rps                        | #taxi-notify      | team-taxi | Draft    | P2 - Medium | S2 - Major | perf,slo              |
| NFR-105 | Уведомление о приезде такси           | API-Contract/Errors       | Ошибки возвращаются в формате RFC 7807 без стэктрейсов                           | Предсказуемость и безопасность          | **Given** ошибка при POST /api/notifications/ride-arrival<br>**When** клиент получает ответ<br>**Then** RFC7807, нет stack | test: contract-error                    | #taxi-notify      | team-taxi | Draft    | P2 - Medium | S2 - Major | api,error             |
| NFR-106 | Уведомление о приезде такси           | Security-InputValidation  | Размер тела запроса ≤ 0.5 MiB, MIME только из allowlist, лишние поля запрещены   | Защита от DoS и грязных данных          | **Given** тело 1 MiB или неизвестные поля<br>**When** POST /api/notifications/ride-arrival<br>**Then** 413 или 400        | test: input-validation                  | #taxi-notify      | team-taxi | Draft    | P2 - Medium | S2 - Major | validation,security   |

<!-- ...добавляйте новые строки ниже для других NFR... -->
